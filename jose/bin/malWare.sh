#!/bin/sh
# Buscar los posibles en /var/spool/anacron
# As√≠, los modificados hoy, con un find -newer un fichero creado hoy a las 0:00
# Miramos touch -d STRING
# en STRING hay que poner el dia de hoy, con date -d ""
#
# $ touch -d "" $TEST_ANACRON
# $ find /var/spool/anacron/ -newer $TEST_ANACRON
TEST_ANACRON=~/testAnacron
FECHA=""
[ $# -eq 0 ]|| FECHA=$1
touch -d "$FECHA" $TEST_ANACRON

#printf "%s\n" "$0 Revisando antivirus..."
# Buscar /var/spool/anacron/clamscan.~jose
FIN_CLAMSCAN=$(find /var/spool/anacron/ -name clamscan.jose -newer $TEST_ANACRON | wc -l)
if [ $FIN_CLAMSCAN -eq 0 ]
then
    printf "%s\n" "$0 La tarea de buscar virus no ha terminado..."
else
    printf "%s\n" "$0 Revisando antivirus..."
    ~jose/bin/revisaLogClamAV.sh
fi

# Buscar /var/spool/anacron/buscaRootkits.jose
FIN_ROOTK=$(find /var/spool/anacron/ -name buscaRootkits.jose -newer $TEST_ANACRON | wc -l)
if [ $FIN_ROOTK -eq 0 ]
then
    printf "%s\n" "$0 La tarea de buscar rootkit no ha terminado..."
else
    printf "\n%s\n" "$0 Revisando rootkit 1 ..."
    ~jose/bin/revisaLogChkrootkit.sh

    printf "\n%s\n" "$0 Revisando rootkit 2 ..."
    ~jose/bin/revisaLogRkHunter.sh $FECHA
fi
printf "\n%s\n" "$0 Listo!!"
#rm $TEST_ANACRON
